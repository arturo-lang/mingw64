name: CI

on:
  push:
    branches: ["*"]
  pull_request:

jobs:
  build:
    runs-on: windows-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Setup MSYS2
        uses: msys2/setup-msys2@v2
        with:
          msystem: UCRT64
          update: true
          install: >-
            git python base-devel

      - name: Build and install package
        shell: msys2 {0}
        run: |
          set -euxo pipefail
          dos2unix PKGBUILD
          dos2unix 001-no-static-linking.patch
          MINGW_ARCH=ucrt64 makepkg-mingw -sif --noconfirm --noprogressbar --skippgpcheck

      - name: Debug and verify installation
        shell: msys2 {0}
        run: |
          set -euxo pipefail
          
          echo "============================================"
          echo "ENVIRONMENT VARIABLES"
          echo "============================================"
          echo "HOME: $HOME"
          echo "USER: $USER"
          echo "PWD: $(pwd)"
          echo "PATH: $PATH"
          echo ""
          
          echo "============================================"
          echo "HOME DIRECTORY RESOLUTION"
          echo "============================================"
          echo "~ expands to:"
          cd ~ && pwd
          echo "realpath of ~: $(realpath ~)"
          echo ""

          echo "============================================"
          echo "CHECK IF arturo.exe IS IN PATH"
          echo "============================================"
          which arturo
          echo ""
          
